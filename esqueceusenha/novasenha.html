<php

// Processa a recuperação de senha
if ($_SERVER["REQUEST_METHOD"] === "POST" && isset($_POST['acao']) && $_POST['acao'] === 'esqueceu_senha') {
    $identificacao = trim($_POST['identificacao']);
 
    if (empty($identificacao)) {
        $erro = "Por favor, insira o seu e-mail ou telefone.";
        $mostrarFormulario = 'esqueceuSenha';
    } else {
        $arquivo = fopen("usuarios/usuarios.txt", "r"); // Caminho para o arquivo dentro da pasta 'dados'
        $encontrado = false;
        while (($linha = fgets($arquivo)) !== false) {
            $dados = explode(",", trim($linha));
            if (count($dados) >= 4 && $dados[3] === $identificacao) { // A quarta posição é o e-mail ou telefone
                $_SESSION['cpf'] = $dados[0]; // Armazena o CPF do usuário para redefinir a senha
                $encontrado = true;
                break;
            }
        }
        fclose($arquivo);
 
        if ($encontrado) {
            $mensagem = "Insira uma nova senha.";
            $mostrarFormulario = 'novaSenha';
        } else {
            $erro = "E-mail ou telefone não encontrado.";
            $mostrarFormulario = 'esqueceuSenha';
        }
    }
}
?>
        <!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redefinir Senha</title>
    <link rel="stylesheet" href="novasenha.css">

</head>
<body>
    <div class="form-container">
        <form id="formCadastro" action="">
            <h2>Redefinir Senha</h2>
            <div class="inp-senha">
                <label for="novasenha">Nova Senha</label>
                <input type="password" name="novasenha" id="novasenha" placeholder="Digite sua nova senha" required>
                <label for="confsenha">Confirme Nova Senha</label>
                <input type="password" name="confsenha" id="confsenha" placeholder="Confirme sua nova senha" required>
            </div>
            <button type="submit" class="submit-btn">Enviar</button>

            <!-- Div para exibir mensagens -->
            <div id="mensagem"></div>
        </form>
    </div>

    <script>
        window.onload = function () {
            const form = document.querySelector('#formCadastro');
            const novaSenha = document.getElementById('novasenha');
            const confSenha = document.getElementById('confsenha');
            const mensagemDiv = document.getElementById('mensagem');

            form.onsubmit = function (event) {
                event.preventDefault();

                // Limpar mensagens anteriores
                mensagemDiv.style.display = 'none';
                mensagemDiv.classList.remove('mensagem-sucesso', 'mensagem-erro');

                // Verificar se as senhas são iguais
                if (novaSenha.value !== confSenha.value) {
                    mensagemDiv.textContent = 'As senhas não coincidem. Por favor, tente novamente.';
                    mensagemDiv.classList.add('mensagem-erro');
                    mensagemDiv.style.display = 'block';
                    return;
                }

                // Exibe mensagem de sucesso e permite o envio
                mensagemDiv.textContent = 'Senha redefinida com sucesso!';
                mensagemDiv.classList.add('mensagem-sucesso');
                mensagemDiv.style.display = 'block';

                // Simula envio (ou redirecione, conforme necessário)
                setTimeout(() => {
                    form.reset(); // Reseta o formulário
                    mensagemDiv.style.display = 'none'; // Esconde a mensagem
                }, 2000);
            };
        };
    </script>
</body>
</html>
